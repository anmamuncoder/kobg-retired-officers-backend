openapi: 3.0.3

info:
  title: User Management API
  description: |
    REST API for user registration, authentication, profile management, 
    and admin operations. Uses JWT-based authentication via SimpleJWT.
  version: 1.0.0
  contact:
    name: API Support

servers:
  - url: http://localhost:8000
    description: Local development server
  - url: https://your-domain.com
    description: Production server

tags:
  - name: Authentication
    description: User registration and login
  - name: Users
    description: User listing and profile management
  - name: Admin
    description: Admin-only operations (requires staff/admin privileges)

# ─────────────────────────────────────────────
# SECURITY SCHEMES
# ─────────────────────────────────────────────
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token obtained from the /users/login/ endpoint.

  # ─────────────────────────────────────────────
  # REUSABLE SCHEMAS
  # ─────────────────────────────────────────────
  schemas:

    # ── Tagged Memory Photo ────────────────────
    TaggedMemoryPhoto:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "c2612373-1d9a-466a-af6e-20c540a00c1a"
        image:
          type: string
          example: "/media/memories/user_0ee4459f-2990-48a4-ab38-8007d6246f1c/its-a-our-final-memory/its-a-our-fina_Qi8jCEg.jpg"
        captured_at:
          type: string
          format: date-time
          example: "2026-02-24T09:01:55Z"

    # ── Tagged By (tagger info) ────────────────
    TaggedBy:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "e315754c-38ac-4b63-8efe-d22023e4cbc9"
        name:
          type: string
          example: "NUR MOHUMMOD AL MAMUN"
        rank_type:
          type: string
          example: "Service Number BA/BSS"
        rank:
          type: string
          example: "colonel"
        decoration:
          type: string
          example: "Gallantry Award"
          nullable: true

    # ── Tagged Memory ──────────────────────────
    TaggedMemory:
      type: object
      properties:
        tag_by:
          $ref: '#/components/schemas/TaggedBy'
        memory_id:
          type: string
          format: uuid
          example: "3baf70f6-988d-4a90-90fa-b95e3d057913"
        photos:
          type: array
          items:
            $ref: '#/components/schemas/TaggedMemoryPhoto'

    # ── User (full profile, read) ──────────────
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
          example: "550e8400-e29b-41d4-a716-446655440000"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        number_type:
          type: string
          example: "Service Number BA/BSS"
        number:
          type: string
          example: "BA-12345"
        rank:
          type: string
          enum:
            - second_lieutenant
            - lieutenant
            - captain
            - major
            - lieutenant_colonel
            - colonel
            - brigadier_general
            - major_general
            - lieutenant_general
            - general
          description: |
            Military rank of the user. Accepted values (stored value → display label):
            - `second_lieutenant` → 2nd Lieutenant
            - `lieutenant` → Lieutenant
            - `captain` → Captain
            - `major` → Major
            - `lieutenant_colonel` → Lieutenant Colonel
            - `colonel` → Colonel
            - `brigadier_general` → Brigadier General
            - `major_general` → Major General
            - `lieutenant_general` → Lieutenant General
            - `general` → General
          example: "major"
          nullable: true
        full_name:
          type: string
          example: "John Doe"
          nullable: true
        decoration:
          type: string
          example: "MC"
          nullable: true
        photo:
          type: string
          format: uri
          example: "/media/profile/john_doe.jpg"
          nullable: true
        course_type:
          type: string
          example: "Long Course"
          nullable: true
        course_number:
          type: string
          example: "LC-99"
          nullable: true
        retirement_date:
          type: string
          format: date
          example: "2030-12-31"
          nullable: true
        ts_number:
          type: string
          example: "TS-9876"
          nullable: true
        address_type:
          type: string
          example: "Permanent"
          nullable: true
        present_address:
          type: object
          description: Present address as a JSON object.
          example:
            street: "House 12, Road 5"
            city: "Dhaka"
            district: "Dhaka"
            division: "Dhaka"
            country: "Bangladesh"
          nullable: true
        permanent_address:
          type: object
          description: Permanent address as a JSON object.
          example:
            village: "Karimpur"
            po: "Karimpur"
            district: "Sylhet"
            division: "Sylhet"
            country: "Bangladesh"
          nullable: true
        phone:
          type: string
          example: "+8801711000000"
          nullable: true
        whatsapp_number:
          type: string
          example: "+8801711000000"
          nullable: true
        nok_name:
          type: string
          example: "Jane Doe"
          nullable: true
        nok_phone:
          type: string
          example: "+8801711000001"
          nullable: true
        nok_relation:
          type: string
          example: "Spouse"
          nullable: true
        is_staff:
          type: boolean
          readOnly: true
          example: false
        is_active:
          type: boolean
          readOnly: true
          example: true
        created_at:
          type: string
          format: date-time
          readOnly: true
          example: "2026-02-20T11:38:46.807156Z"
        updated_at:
          type: string
          format: date-time
          readOnly: true
          example: "2026-02-21T19:23:09.952689Z"


    # ── Registration request ───────────────────
    UserRegistrationRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        password:
          type: string
          format: password
          writeOnly: true
          example: "SecurePass@123"
        photo:
          type: string
          format: uri
          example: "/media/profile/john_doe.jpg"
          nullable: true
        number_type:
          type: string
          example: "Service Number BA/BSS"
        number:
          type: string
          example: "BA-12345"
        rank:
          type: string
          enum:
            - second_lieutenant
            - lieutenant
            - captain
            - major
            - lieutenant_colonel
            - colonel
            - brigadier_general
            - major_general
            - lieutenant_general
            - general
          example: "major"
        full_name:
          type: string
          example: "John Doe"
        decoration:
          type: string
          example: "MC"
        course_type:
          type: string
          example: "Long Course"
        course_number:
          type: string
          example: "LC-99"
        retirement_date:
          type: string
          format: date
          example: "2030-12-31"
        ts_number:
          type: string
          example: "TS-9876"
        address_type:
          type: string
          example: "Permanent"
        present_address:
          type: object
          description: Present address as a JSON object.
          example:
            street: "House 12, Road 5"
            city: "Dhaka"
            district: "Dhaka"
            division: "Dhaka"
            country: "Bangladesh"
        permanent_address:
          type: object
          description: Permanent address as a JSON object.
          example:
            village: "Karimpur"
            po: "Karimpur"
            district: "Sylhet"
            division: "Sylhet"
            country: "Bangladesh"
        phone:
          type: string
          example: "+8801711000000"
        whatsapp_number:
          type: string
          example: "+8801711000000"
        nok_name:
          type: string
          example: "Jane Doe"
        nok_phone:
          type: string
          example: "+8801711000001"
        nok_relation:
          type: string
          example: "Spouse"

    # ── Login request ──────────────────────────
    UserLoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        password:
          type: string
          format: password
          writeOnly: true
          example: "SecurePass@123"

    # ── Login response ─────────────────────────
    UserLoginResponse:
      type: object
      properties:
        message:
          type: string
          example: "Login successful"
        user_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        access_key:
          type: string
          description: Short-lived JWT access token.
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refresh_key:
          type: string
          description: Long-lived JWT refresh token.
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        is_staff:
          type: boolean
          example: false

    # ── Profile update (partial or full) ───────
    UserProfileUpdateRequest:
      type: object
      description: All fields are optional for PATCH. Provide all fields for PUT.
      properties:
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        number_type:
          type: string
          example: "Service Number BA/BSS"
        number:
          type: string
          example: "BA-12345"
        rank:
          type: string
          enum:
            - second_lieutenant
            - lieutenant
            - captain
            - major
            - lieutenant_colonel
            - colonel
            - brigadier_general
            - major_general
            - lieutenant_general
            - general
          example: "major"
        full_name:
          type: string
          example: "John Doe"
        decoration:
          type: string
          example: "MC"
        course_type:
          type: string
          example: "Long Course"
        course_number:
          type: string
          example: "LC-99"
        retirement_date:
          type: string
          format: date
          example: "2030-12-31"
        ts_number:
          type: string
          example: "TS-9876"
        address_type:
          type: string
          example: "Permanent"
        present_address:
          type: object
          description: Present address as a JSON object.
          example:
            street: "House 12, Road 5"
            city: "Dhaka"
            district: "Dhaka"
            division: "Dhaka"
            country: "Bangladesh"
        permanent_address:
          type: object
          description: Permanent address as a JSON object.
          example:
            village: "Karimpur"
            po: "Karimpur"
            district: "Sylhet"
            division: "Sylhet"
            country: "Bangladesh"
        phone:
          type: string
          example: "+8801711000000"
        whatsapp_number:
          type: string
          example: "+8801711000000"
        nok_name:
          type: string
          example: "Jane Doe"
        nok_phone:
          type: string
          example: "+8801711000001"
        nok_relation:
          type: string
          example: "Spouse"

    # ── Admin creation request ─────────────────
    AdminCreationRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "admin@example.com"
        password:
          type: string
          format: password
          writeOnly: true
          example: "AdminPass@123"
        number_type:
          type: string
          example: "Service Number BA/BSS"
        number:
          type: string
          example: "BA-99999"
        phone:
          type: string
          example: "+8801700000000"
        whatsapp_number:
          type: string
          example: "+8801700000000"

    # ── Admin creation response ────────────────
    AdminCreationResponse:
      type: object
      properties:
        message:
          type: string
          example: "Admin user created successfully"
        admin:
          type: object
          properties:
            id:
              type: string
              format: uuid
              example: "660e8400-e29b-41d4-a716-446655440000"
            email:
              type: string
              format: email
              example: "admin@example.com"
            number_type:
              type: string
              example: "Service Number BA/BSS"
            number:
              type: string
              example: "BA-99999"
            phone:
              type: string
              example: "+8801700000000"
            whatsapp_number:
              type: string
              example: "+8801700000000"
            is_active:
              type: boolean
              example: true
            is_staff:
              type: boolean
              example: true

    # ── Approval request ───────────────────────
    UserApprovalRequest:
      type: object
      required:
        - user_id
      properties:
        user_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"

    # ── Rejection request ──────────────────────
    UserRejectRequest:
      type: object
      required:
        - user_id
        - reason
      properties:
        user_id:
          type: string
          format: uuid
          description: UUID of the user to reject.
          example: "d97e643d-03f2-4c6b-b6d5-280d121b6b9a"
        reason:
          type: string
          description: Reason for rejection. Sent to the user via email before deletion.
          example: "Incomplete profile and invalid documents."

    # ── Error responses ────────────────────────
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "An error occurred."

    ValidationErrorResponse:
      type: object
      description: Field-level validation errors returned by DRF serializers.
      additionalProperties:
        type: array
        items:
          type: string
      example:
        email:
          - "This field is required."
        password:
          - "This field may not be blank."


# ─────────────────────────────────────────────
# PATHS
# ─────────────────────────────────────────────
paths:

  # ── Registration ───────────────────────────
  /users/register/:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: |
        Creates a new user account. The account is set to **inactive** (`is_active: false`)
        by default and must be approved by an admin before the user can log in.
      operationId: userRegister
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistrationRequest'
      responses:
        '201':
          description: User registered successfully. Awaiting admin approval.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User registered successfully. Please wait for admin approval."
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          description: Validation error (e.g. duplicate email or missing required fields).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'

  # ── Login ──────────────────────────────────
  /users/login/:
    post:
      tags:
        - Authentication
      summary: Login and obtain JWT tokens
      description: |
        Authenticates the user with email and password.  
        Returns a JWT **access_key** (short-lived) and **refresh_key** (long-lived).  
        Use the `access_key` as a Bearer token in the `Authorization` header for 
        all protected endpoints.  
        Returns a `400` error if credentials are invalid **or** if the account 
        is inactive (pending admin approval).
      operationId: userLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLoginRequest'
      responses:
        '200':
          description: Login successful.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserLoginResponse'
        '400':
          description: Invalid credentials or inactive account.
          content:
            application/json:
              schema:
                type: object
                properties:
                  non_field_errors:
                    type: array
                    items:
                      type: string
                    example:
                      - "Invalid email or password"

  # ── User List ──────────────────────────────
  /users/list/:
    get:
      tags:
        - Users
      summary: List all users
      description: Returns a list of all registered users. Requires authentication.
      operationId: userList
      security:
        - BearerAuth: []
      responses:
        '200':
          description: A list of users.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          description: Authentication credentials were not provided or are invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                detail: "Authentication credentials were not provided."

  # ── User List Retrieve ──────────────────────
  /users/list/{id}/:
    get:
      tags:
        - Users
      summary: Retrieve a single user by ID
      description: |
        Returns a single user's full profile including their `tagged_memorys` —
        the list of memories in which the user has been tagged, along with
        the tagger's info and the associated photos.  
        Requires authentication.
      operationId: userRetrieve
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: UUID of the user.
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User retrieved successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
              example:
                id: "e315754c-38ac-4b63-8efe-d22023e4cbc9"
                email: "anmamuncodere@gmail.com"
                number_type: "Service Number BA/BSS"
                number: "BA/BSS0014dsf"
                rank: "colonel"
                full_name: "NUR MOHUMMOD AL MAMUN"
                decoration: "Gallantry Award"
                photo: null
                course_type: "Military Command"
                course_number: "MC-2020"
                retirement_date: "2020-06-30"
                ts_number: "TS-001"
                address_type: "Residential"
                present_address: {}
                permanent_address: {}
                phone: "+880-1234567890"
                whatsapp_number: "+880-1234567890"
                nok_name: "Jane Doe"
                nok_phone: "+880-9876543210"
                nok_relation: "Spouse"
                is_staff: false
                is_active: false
                created_at: "2026-02-21T09:55:07.862652Z"
                updated_at: "2026-02-21T09:55:07.882133Z"
                tagged_memorys:
                  - tag_by:
                      id: "e315754c-38ac-4b63-8efe-d22023e4cbc9"
                      name: "NUR MOHUMMOD AL MAMUN"
                      rank_type: "Service Number BA/BSS"
                      rank: "colonel"
                      decoration: "Gallantry Award"
                    memory_id: "3baf70f6-988d-4a90-90fa-b95e3d057913"
                    photos:
                      - id: "c2612373-1d9a-466a-af6e-20c540a00c1a"
                        image: "/media/memories/user_0ee4459f-2990-48a4-ab38-8007d6246f1c/its-a-our-final-memory/its-a-our-fina_Qi8jCEg.jpg"
                        captured_at: "2026-02-24T09:01:55Z"
                      - id: "cf6bd6e6-fc13-4075-a67c-9dbd0f42c56d"
                        image: "/media/memories/user_0ee4459f-2990-48a4-ab38-8007d6246f1c/its-a-our-final-memory/its-a-our-fina_wqUJjz1.png"
                        captured_at: "2026-02-24T09:02:15Z"
        '401':
          description: Authentication credentials were not provided or are invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ── Profile (ViewSet via Router) ───────────
  /users/profile/:
    get:
      tags:
        - Users
      summary: Retrieve own profile
      description: |
        Returns the authenticated user's own profile, including `tagged_memorys`.  
        The result is a list containing only the requesting user's data.
      operationId: profileList
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Profile retrieved successfully.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
              example:
                - id: "bf8fc301-9cbc-4174-8f99-b8d520ac03b7"
                  email: "anmamuncoder@gmail.com"
                  number_type: "Service Number BA/BSS"
                  number: "BA/BSS0014"
                  rank: "colonel"
                  full_name: "AN"
                  decoration: "Gallantry Award"
                  photo: null
                  course_type: "Military Command"
                  course_number: "MC-2020"
                  retirement_date: "2020-06-30"
                  ts_number: "TS-001"
                  address_type: "Residential"
                  present_address: null
                  permanent_address: null
                  phone: "+880-1234567890"
                  whatsapp_number: "+880-1234567890"
                  nok_name: "Jane Doe"
                  nok_phone: "+880-9876543210"
                  nok_relation: "Spouse"
                  is_staff: false
                  is_active: true
                  created_at: "2026-02-20T11:38:46.807156Z"
                  updated_at: "2026-02-21T19:23:09.952689Z"
                  tagged_memorys:
                    - tag_by:
                        id: "bf8fc301-9cbc-4174-8f99-b8d520ac03b7"
                        name: "AN"
                        rank_type: "Service Number BA/BSS"
                        rank: "colonel"
                        decoration: "Gallantry Award"
                      memory_id: "3baf70f6-988d-4a90-90fa-b95e3d057913"
                      photos:
                        - id: "c2612373-1d9a-466a-af6e-20c540a00c1a"
                          image: "/media/memories/user_0ee4459f-2990-48a4-ab38-8007d6246f1c/its-a-our-final-memory/its-a-our-fina_Qi8jCEg.jpg"
                          captured_at: "2026-02-24T09:01:55Z"
                        - id: "cf6bd6e6-fc13-4075-a67c-9dbd0f42c56d"
                          image: "/media/memories/user_0ee4459f-2990-48a4-ab38-8007d6246f1c/its-a-our-final-memory/its-a-our-fina_wqUJjz1.png"
                          captured_at: "2026-02-24T09:02:15Z"
        '401':
          description: Unauthorized.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/profile/{id}/:
    get:
      tags:
        - Users
      summary: Retrieve own profile by ID
      description: |
        Returns the authenticated user's profile by UUID, including `tagged_memorys`.  
        Users can only access their own profile.
      operationId: profileRetrieve
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: UUID of the user.
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Profile retrieved.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Profile not found (or belongs to another user).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Users
      summary: Update own profile (full update)
      description: |
        Fully replaces the authenticated user's profile.  
        All writable fields must be provided. Users cannot update other profiles.  
        `id`, `is_staff`, `is_active`, `created_at`, `updated_at`, and `tagged_memorys`
        are read-only and will be ignored if sent.
      operationId: profileUpdate
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: UUID of the user.
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserProfileUpdateRequest'
      responses:
        '200':
          description: Profile updated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          description: Unauthorized.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Permission denied — cannot update another user's profile.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      tags:
        - Users
      summary: Partially update own profile
      description: |
        Updates one or more fields of the authenticated user's profile.  
        Only the fields provided in the request body are updated.  
        `id`, `is_staff`, `is_active`, `created_at`, `updated_at`, and `tagged_memorys`
        are read-only and will be ignored if sent.
      operationId: profilePartialUpdate
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: UUID of the user.
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserProfileUpdateRequest'
      responses:
        '200':
          description: Profile partially updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          description: Unauthorized.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Permission denied — cannot update another user's profile.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ── Admin: Approve User ────────────────────
  /users/approve/:
    post:
      tags:
        - Admin
      summary: Approve (activate) a user account
      description: |
        Activates a pending user account identified by `user_id`.  
        After activation, the user receives a confirmation email.  
        **Requires admin/staff privileges.**
      operationId: userApprove
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserApprovalRequest'
      responses:
        '200':
          description: User approved and activated (or was already active).
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User approved and activated successfully"
                  user_id:
                    type: string
                    format: uuid
                    example: "550e8400-e29b-41d4-a716-446655440000"
                  email:
                    type: string
                    format: email
                    example: "john.doe@example.com"
                  is_active:
                    type: boolean
                    example: true
        '400':
          description: Missing `user_id` in the request body.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "user_id is required"
        '401':
          description: Unauthorized.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden — caller is not an admin/staff user.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "User not found"

  # ── Admin: Reject User ─────────────────────
  /users/reject/:
    post:
      tags:
        - Admin
      summary: Reject (deactivate or delete) a user account
      description: |
        Performs a two-stage rejection based on the user's current `is_active` status:

        **Stage 1 — User is currently active (`is_active: true`):**  
        Sets `is_active` to `false` (deactivates the account). No email is sent
        and the user record is kept in the database. The admin can call this
        endpoint again to proceed to Stage 2.

        **Stage 2 — User is already inactive (`is_active: false`):**  
        Sends a rejection email to the user with the provided `reason`, then
        **permanently deletes** the user record from the database.

        **Requires admin/staff privileges.**
      operationId: userReject
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRejectRequest'
            example:
              user_id: "d97e643d-03f2-4c6b-b6d5-280d121b6b9a"
              reason: "Incomplete profile and invalid documents."
      responses:
        '200':
          description: |
            Action taken depends on the user's prior `is_active` state:
            - **Was active → now deactivated** (`message`: "Deactivated user successfully")
            - **Was inactive → email sent & deleted** (`message`: "User rejected and deleted successfully")
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Deactivated user successfully"
                  user_id:
                    type: string
                    format: uuid
                    example: "d97e643d-03f2-4c6b-b6d5-280d121b6b9a"
                  email:
                    type: string
                    format: email
                    example: "officer@example.com"
                  is_active:
                    type: boolean
                    description: |
                      Reflects the user's `is_active` value **before** this action was taken.
                      - `true`  → user was active and has now been deactivated.
                      - `false` → user was already inactive and has now been deleted.
                    example: true
                  reason:
                    type: string
                    description: Only present when the user is deleted (Stage 2).
                    example: "Incomplete profile and invalid documents."
                    nullable: true
              examples:
                deactivated:
                  summary: Stage 1 — User was active, now deactivated
                  value:
                    message: "Deactivated user successfully"
                    user_id: "d97e643d-03f2-4c6b-b6d5-280d121b6b9a"
                    email: "officer@example.com"
                    is_active: true
                deleted:
                  summary: Stage 2 — User was inactive, email sent and record deleted
                  value:
                    message: "User rejected and deleted successfully"
                    user_id: "d97e643d-03f2-4c6b-b6d5-280d121b6b9a"
                    email: "officer@example.com"
                    is_active: false
                    reason: "Incomplete profile and invalid documents."
        '400':
          description: Missing required fields (`user_id` or `reason`).
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
              examples:
                missing_user_id:
                  summary: user_id not provided
                  value:
                    error: "user_id is required"
                missing_reason:
                  summary: reason not provided
                  value:
                    error: "reason is required"
        '401':
          description: Unauthorized — no valid Bearer token provided.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden — caller is not an admin/staff user.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "User not found"

  # ── Admin: Create Admin ────────────────────
  /users/create-admin/:
    post:
      tags:
        - Admin
      summary: Create a new admin (staff) user
      description: |
        Creates a new staff-level user who is immediately active (`is_active: true`).  
        The created user has `is_staff: true` and `is_superuser: false`.  
        Only the fields accepted by `AdminCreationSerializer` are used:
        `email`, `password`, `number_type`, `number`, `phone`, `whatsapp_number`.  
        **Requires admin/staff privileges.**
      operationId: adminCreate
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminCreationRequest'
      responses:
        '201':
          description: Admin user created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminCreationResponse'
        '400':
          description: Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          description: Unauthorized.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden — caller is not an admin/staff user.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'